<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title></title>
    <script language="javascript" src="../addons/sz_yi/static/js/dist/jquery-1.11.1.min.js"></script>
    <style>
        @charset "utf-8";
        body,h1,h2,h3,h4,h5,h6,hr,i,em,b,p,blockquote,dl,dt,dd,ul,ol,li,pre,form,fieldset,legend,button,th,td,img,a,tr,img {
            margin:0;padding:0;border:0;outline:none;list-style:none;font-family: 微软雅黑, Microsoft Yahei;font-weight: normal;
            font-style:normal;color:#888888; }
        html, body{height: 100%;background: #f7f7f7!important;font-size:62.5%;width:100%; min-width: 320px;max-width:720px;margin:0 auto}
        body, em, b, ol, a, i, span, nav, strong {display: inline-block;max-width:720px;margin:0 auto;}
        a {font-size:1.4rem;text-decoration:none !important;outline: none;}
        a:hover,.w-input,textarea,.sig-button,.dev-table>ul>li>a {
            -webkit-transition-property:all;
            -moz-transition-property:all;
            transition-property:all;
            -webkit-transition-timing-function:ease-in-out;
            transition-timing-function:ease-in-out;
            -moz-transition-timing-function:ease-in-out;
            -webkit-transition-duration:0.30s;
            -moz-transition-duration:0.30s;
            transition-duration:0.30s;
        }
        .red{ color:#eb5f5f}
        .tac{ text-align:center}
        img{ max-width: 100%; display: block;}
        button{	cursor: pointer; font-family: 微软雅黑, Microsoft Yahei;}
        textarea{ font-family: 微软雅黑, Microsoft Yahei;}
        input{
            color: #585858;
            font-family: 微软雅黑, Microsoft Yahei;
            font-size: 16px;
            outline: none;
        }
        input{
            color: #585858;
            font-family: 微软雅黑, Microsoft Yahei;
            font-size: 16px;
            outline: none;
        }
        ::-webkit-input-placeholder {
            color: #888888;
        }
        :-moz-placeholder {
            color: #888888;
        }
        ::-moz-placeholder {
            color: #888888;
        }
        :-ms-input-placeholder {
            color: #888888;
        }
        .clearfix{	clear: both;}
        .fl{ float: left!important;}
        .fr{ float: right!important;}
        .m0a{ margin:0 auto!important;}
        /**/
        .notice-tit{color:#2cb0ea;font-size:24px;text-align:center;padding:10px 0 0 }
        .notice-p{font-size:12px;padding:10px;line-height:18px;color:#FDA300}

        .bgfff{ width:100%;background:#fff;overflow:hidden;}
        .tab{height:40px;width:96%;border-bottom:1px #d6d6d6 solid;line-height:40px;margin:0 auto}
        .tab a{ display:block;width:40%;float:left;text-align:center;font-size:1.4rem;margin:0 5%;line-height: 39px;color:#333333}
        .tab a:hover,.tab a.hover{ border-bottom:2px #2cb0ea solid;color:#2cb0ea}
        .tel-pos{ position:relative}
        .telphone{ width:96%;line-height:40px;border:1px #cccccc solid;padding-left:10px;margin:10px 2%;box-sizing: border-box;}
        .yys-pos{ position:absolute;right:20px;top:0;color:#2cb0ea;line-height:64px;font-size:12px}

        .h-not{color:#666;line-height:36px;padding:0 10px}
        .list-pos ul li{border-bottom:1px #D6D6D6 solid;position:relative;padding-right:86px;}
        .list-pos ul li a{position:absolute;right:5px;top:50%;margin-top:-14px;height:26px;border:1px #2cb0ea  solid;width:76px;font-size:14px;color: #2cb0ea;text-align: center;line-height: 26px;border-radius: 4px;}
        .list-pos ul li p{ padding:6px 0 6px 6px;line-height:16px;color:#333;min-height:32px;font-size:14px;display:inline-block;top:50%;}
        .list-pos ul li p span{color: #B1B1B1;text-decoration: line-through;}
        #loading {
            width:40%;
            height:100px;
            position:relative;
            top:auto;
            left:30%;
            z-index:10000;
            background-color:black;
            font-size:11pt;
            display:none;
            filter: alpha(opacity=70); opacity: 0.7;
            border-radius: 5px;
        }
        #loading p{
            color:white;
            line-height:100px;
            text-align:center;

        }


    </style>
</head>
<body style="background:#e6e6e6">
<h1 class="notice-tit">流量话费充值</h1>
<p class="notice-p">{php echo $rechargeset['rechargenotice'];}</p>
<div class="bgfff">
    <!--<div class="tab">-->
        <!--<a href="#" class="hover">流量充值</a>-->
        <!--<a href="#">话费充值</a>-->
    <!--</div>-->
    <div class="tel-pos"><input type="text" placeholder="请输入手机号码" class="telphone" id="telephone" maxlength="11" value="">
        <i class="yys-pos" id="catname"></i>
    </div>
</div>
<!--<div class="h-not">广东佛山移动 全国可用 立即生效 月结日失效</div>-->
<div class="bgfff" id="options">
    <div class="tab" id="tab">
        <a href="#" class="hover" class="type" type='domestic'>国内流量</a>
        <a href="#" class="type" type='provincial'>省内流量</a>
    </div>
    <div class="list-pos">
        <ul id="specs">
        </ul>
    </div>
</div>
<div class="h-not">充值规则:输入手机号显示价格</div>
<div id="loading"><p>数据加载中</p></div>
</body>
<script>
    $(document).ready(function(){
        $("#tab").hide();
        $('#telephone').bind('input propertychange', function() {
            var cc = $(this).val().length;
            if (cc >= 11) {
                if(!(/^1[34578]\d{9}$/.test($(this).val()))){ 
                    alert("手机格式填写错误！");
                    window.location.reload();
                }else {
                    $.ajax({
                        type: "POST",
                        url: "{php echo $this->createPluginMobileUrl('recharge/mobile_check')}",
                        data: {mobile:$("#telephone").val(), goodsid:"{php echo $_GPC['id']}"},
                        dataType: "json",
                        success: function(result){
                            var specs = result.spec_datas;
                            $("#catname").html(result.carrier);
                            if (result.code == 1) {
                                var html = '';
                                var html_pro = '';
                                var html_dom = '';
                                var provincial =  specs.provincial;
                                var domestic =  specs.domestic;
                                //只有国内或省内
                                if (provincial != undefined && domestic != undefined) {
                                    $("#tab").show();
                                    $.each(domestic,function(key,value){ 
                                            html_dom += '<li><a href="#" optionid="' + value["optionid"] + '" class="pay">' + value["price"] + '</a> ';
                                            html_dom += '<p>' + value["itemtitle"] + '</p></li>';
                                        })
                                    $("#specs").html(html_dom);
                                    $("#tab a").on('click',function(){
                                        if ($(this).attr('type') == "provincial") {
                                            html_pro = '';
                                            $(this).addClass('hover');
                                            $("#tab a").prev().removeClass();
                                            $.each(provincial,function(key,value){    
                                                html_pro += '<li><a href="#" optionid="' + value["optionid"] + '" class="pay">' + value["price"] + '</a> ';
                                                html_pro += '<p>' + value["itemtitle"] + '</p></li>';
                                            })
                                            $("#specs").html(html_pro);
                                        } else if ($(this).attr('type') == "domestic"){
                                            html_dom = '';
                                            $(this).addClass('hover');
                                            $("#tab a").next().removeClass();
                                            $.each(domestic,function(key,value){ 
                                                html_dom += '<li><a href="#" optionid="' + value["optionid"] + '" class="pay">' + value["price"] + '</a> ';
                                                html_dom += '<p>' + value["itemtitle"] + '</p></li>';
                                            })
                                            $("#specs").html(html_dom);
                                        }
                                    })
                                    
                                } else {
                                    $("#tab").hide();
                                    if (provincial != undefined) {
                                        
                                        $.each(provincial,function(key,value){ 
                                            html += '<li><a href="#" optionid="' + value["optionid"] + '" class="pay">' + value["price"] + '</a> ';
                                            html += '<p>' + value["itemtitle"] + '</p></li>';
                                        })  
                                        
                                    }
                                    if (domestic != undefined) {
                                        
                                        $.each(domestic,function(key,value){ 
                                            html += '<li><a href="#" optionid="' + value["optionid"] + '" class="pay">' + value["price"] + '</a> ';
                                            html += '<p>' + value["itemtitle"] + '</p></li>';
                                        }) 
                                    }
                                    $("#specs").html(html);
                                     
                                }
                                
                                
                                $(document).on('click',".pay",function(){
                                    location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$(this).attr('optionid') + "&total=1&telephone="+$("#telephone").val();
                                })
                            } else {
                                alert('该商品不支持号码所属运营商或地区');
                                window.location.reload();
                            }
                            console.log(result);
                        },
                        complete:function(){
                            $("#loading").hide();
                        },beforeSend:function (){
                            $("#loading").show();
                        }
                    });
                }
            }
        });
    })
</script>
</html>
