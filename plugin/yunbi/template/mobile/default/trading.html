{template 'common/header'}
<title>{$yunbi_title}出让</title>
<style type="text/css">
body {margin:0px; background:#efefef; -moz-appearance:none;}
input {-webkit-appearance:none; outline:none;}
.balance_img {height:80px; width:80px; margin:70px auto 0px; background:#ffb400; border-radius:40px; color:#fff; font-size:70px; text-align:center; line-height:90px;}
.balance_text {height:20px; width:100%; margin-top:16px; text-align:center; line-height:20px; font-size:16px; color:#666;}
.balance_num {height:24px; width:100%; margin-top:10px; text-align:center; line-height:24px; font-size:22px; color:#444;}
.balance_list {height:auto; width:100%; text-align:center; color:#92b5d6; font-size:16px; margin-top:80px;}
.balance_sub1 {height:44px; margin:14px 5px; background:#31cd00; border-radius:4px; text-align:center; font-size:16px; line-height:44px; color:#fff;}
.balance_sub2 {height:44px; margin:14px 5px; background:#f49c06; border-radius:4px; text-align:center; font-size:16px; line-height:44px; color:#fff;}
.balance_sub3 {height:44px; margin:14px 5px;background:#e2cb04; border-radius:4px; text-align:center; font-size:16px; line-height:44px; color:#fff; }

</style>
<div id="container"></div>
<div class="page_topbar">
<a href="javascript:;" class="back" onclick="history.back()"><i class='iconfont icon-chevron-left'></i></a>
<div class="title">{$yunbi_title}出让</div>
</div>

<div class="cash-box">
    <div class="balance_price">您的当前{$yunbi_title}
        <span id="credit">￥{$member['virtual_currency']}</span>
    </div> 
    <div class="cash-num cash-num-pt"><span>{$yunbi_title}</span><input type="text" id="money" value='' class="cash-input-z"/></div>
    <div class="cash-num cash-num-pb "></div>
</div>
<div class="button balance_sub1">确认交易</div>


<div class="balance_text">
交易手续费收取<span style="color: #f15353;">{$yunbiset['poundage']}%</span>，</br>
交易限制(最小额度)<span style="color: #f15353;">{$yunbiset['trading_limit']}</span>，</br>
交易限制(倍数)<span style="color: #f15353;">{$yunbiset['trading_fold']}</span>，只有<span style="color: #f15353;">{$yunbiset['trading_fold']}</span>或<span style="">{$yunbiset['trading_fold']}</span>的倍数是可以交易。</br>
</div> 


<script language="javascript">
    require(['tpl', 'core'], function (tpl, core) {
        var virtual_currency ="{$member['virtual_currency']}";
        var yunbi_title = "{$yunbi_title}";
        var trading_limit = "{$yunbiset['trading_limit']}";
        var trading_fold = "{$yunbiset['trading_fold']}";
        var credit = "{$yunbiset['credit']}";
        var trading_money = "{$yunbiset['trading_money']}";
        var poundage = "{$yunbiset['poundage']}";
        
        $('#money').change(function (){
            var html = "";
            if(parseFloat($(this).val()) < parseFloat(trading_limit)) {
                core.tip.show('输入的'+yunbi_title+'不能小于'+trading_limit+'!');
                $('.cash-num-pb').html('');
                return; 
            }
            if (parseFloat($(this).val())%parseFloat(trading_fold) != 0) {
                core.tip.show('请输入的'+trading_fold+'或'+trading_fold+'的倍数!');
                $('.cash-num-pb').html('');
                return;
            }
            var trading = parseFloat($(this).val())*trading_money/credit;
            var poundage_money = trading*poundage/100;
            var trading_total = trading - poundage_money;
            html += "<span>预计可得金额</span>"+ parseFloat(trading_total) +"元";
            html += "<span>手续费</span>"+parseFloat(poundage_money)+"元";
            $('.cash-num-pb').html(html);

        });


        $('.balance_sub1').click(function (){

            var money = $('#money').val();
            if (!$('#money').isNumber()) {
                core.tip.show('请输入出让'+yunbi_title);
                return;
            }
            if (money > parseFloat(virtual_currency)) {
                core.tip.show('输入出让'+yunbi_title+'不能大于总'+yunbi_title);
                return;
            }
            if(parseFloat(money) < parseFloat(trading_limit)) {
                core.tip.show('输入的'+yunbi_title+'不能小于'+trading_limit+'!');
                $('.cash-num-pb').html('');
                return; 
            }
            if (parseFloat(money)%parseFloat(trading_fold) != 0) {
                core.tip.show('请输入的'+trading_fold+'或'+trading_fold+'的倍数!');
                $('.cash-num-pb').html('');
                return;
            }

            core.pjson('yunbi/yunbi_trading', {
                op: 'trading',
                money: money,
            }, function (rjson) {
                if(rjson.status!=1){
                    $(this).removeAttr('submitting');
                    core.tip.show(rjson.result);
                    return;
                }
                core.message('出让已提交，等待交易!',"{php echo $this->createPluginMobileUrl('yunbi/yunbi_trading')}",'success');
            }, true, true);

        });
        
      
    });

</script>
{php $show_footer=true}
{template 'common/footer'}
