{template 'common/header'}
<title>{$set['gift_title']}</title>
<link rel="stylesheet" type="text/css" href="../addons/sz_yi/plugin/coupon/template/mobile/default/images/style.css">
<style type="text/css">
	body {margin:0px; background:#eee; font-family:'微软雅黑'; -moz-appearance:none;overflow-x: hidden; }
	a {text-decoration:none;}

	.tab {height:30px; font-size:13px;background:#fff;padding-right: -2px;}
	.nav {height:30px;border-bottom:2px solid #fff;  width:50%;  background:#fff; color:#666; text-align:center; line-height:30px; float:left;}
	.navon { border-bottom:2px solid #f15353;  color:#f15353;}
	.no {height:100px; margin:50px 0px 60px; color:#ccc; font-size:12px; text-align:center;}
	#coupon_loading { padding:10px;color:#666;text-align: center;}
	.coupon_no {height:100px;  margin:50px 0px 60px; color:#ccc; font-size:12px; text-align:center;}
	.coupon_menu {height:60px; width:100%; }
	.coupon_no_nav {height:38px; background:#eee; margin:0px 3%; border:1px solid #d4d4d4; border-radius:5px; text-align:center; line-height:38px; color:#666;}
	.coupon_more { height:40px; line-height:40px; font-size:14px;color:#232323; margin:10px; border-radius: 5px; background-repeat:no-repeat; border:1px solid #232323; text-align: center; }

	.lw_coupon_item {
		padding:10px 10px 0px 10px;
	}
	.lw_coupon_item .li{
		margin-bottom:10px;
		background: #fff;
		border:1px solid #d9d9d9;
		box-sizing:border-box;
		
		border-radius: 8px;
		overflow: hidden;
	}
	
	.lw_coupon_item .top{
		text-align: center;
		font-size: 18px;
		padding:20px 0px;

	}
	.lw_coupon_item .top .s1{
		font-weight: bold;
		color:#666;

	}
	.lw_coupon_item .top .s2{
		color:#f22;
		margin-left:10px;
	}
	.lw_coupon_item .bottom{
		text-align: center;
		background: #e3e3e3;
		font-size: 12px;
		line-height:40px;
		color:#777;
	}
	.lw_coupon_item .li.in{
		opacity: 0.7;
	}
	.lw_coupon_item .li.in .s2{
		color:#888;
	}
</style>
<div class="page_topbar">
	<a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
	<div class="title">{$set['gift_title']}</div>
</div>

<div class="tab">
	<div class="nav {if $used==0 && $past!=1}navon{/if}" onclick="location.href='{php echo $this->createPluginMobileUrl('card/center')}'">我的{$set['gift_title']}</div>
	<div class="nav {if $past==1}navon{/if}"  onclick="location.href='{php echo $this->createPluginMobileUrl('card/bindcard',array('past'=>1))}'">绑定{$set['gift_title']}</div>
</div>
<div id='container'></div>
<script id='tpl_empty' type='text/html'>
	<div class="coupon_no"><i class="fa fa-credit-card" style="font-size:80px;"></i><br><span style="line-height:18px; font-size:16px;">您还没有{$set['gift_title']}~</span></div>
</script>
<script id='tpl_list' type='text/html'>
	<div class="lw_coupon_item">
		<%each list as row%>
			<div class="li <%row.css%>" onclick="location.href = '{php echo $this->createPluginMobileUrl('card/order')}&cardid=<%row.id%>'">
				<div class="top" >
					<span class="s1">余额 <%row.balance%>元</span>
					<span class="s2"><%if row.css%>[已过期]<%/if%></span>
				</div>
				<div class="bottom" >
					有效期 <%row.timestr%>
				</div>
			</div>
		<%/each%>
	</div>
</script>

<script language='javascript'>
	var page = 1;
	require(['core','tpl'],function(core,tpl){

		core.pjson('card/center', {page:page}, function(json) {

			if (json.result.list.length <= 0) {
				$("#container").html(tpl('tpl_empty'));
				return;
			}
			$("#container").html(tpl('tpl_list', json.result));

			var loaded = false;
			var stop=true;
			$(window).scroll(function(){
				if(loaded){
					return;
				}
				totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
				if($(document).height() <= totalheight){

					if(stop==true){
						stop=false;
						$('#container').append('<div id="coupon_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
						page++;
						core.pjson('card/center', {page:page}, function(morejson) {
							stop = true;
							$('#coupon_loading').remove();
							$("#container").append(tpl('tpl_list', morejson.result));
							if (morejson.result.list.length <morejson.result.pagesize) {
								$('#container').append('<div id="coupon_loading">已经加载全部优惠券</div>');
								loaded = true;
								return;
							}
						},true);
					}
				}
			});
		}, true);
	});

</script>

{php $show_footer = true}
{template 'common/footer'}
