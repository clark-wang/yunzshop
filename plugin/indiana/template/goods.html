{template 'web/_header'}
<div class="w1200 m0a">
<style type="text/css">
    .fa-article:before{content: "\f0f6";}
</style>
{template 'tabs'}
<div class="main rightlist">
<div class="right-addbox">
    <div class="panel panel-info">
        <div class="panel-body">
            <form action="./index.php" method="get" class="form-horizontal" role="form">
                <input type="hidden" name="c" value="site" />
                <input type="hidden" name="a" value="entry" />
                <input type="hidden" name="m" value="sz_yi" />
                <input type="hidden" name="do" value="plugin" />
                <input type="hidden" name="p" value="indiana" />
                <input type="hidden" name="method" value="goods" />
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">关键字</label>
                    <div class="col-xs-12 col-sm-8 col-lg-9">
                        <input class="form-control" name="keyword" id="" type="text" value="{$_GPC['keyword']}">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">状态</label>
                    <div class="col-xs-12 col-sm-8 col-lg-9">
                        <select name="status" class='form-control'>
                            <option value="" {if $_GPC['status'] == ''} selected{/if}></option>
                            <option value="1" {if $_GPC['status']== '1'} selected{/if}>上架</option>
                            <option value="0" {if $_GPC['status'] == '0'} selected{/if}>下架</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 col-sm-2 col-lg-2">
                        <button class="btn btn-default"><i class="fa fa-search"></i> 搜索</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <style>
        .label{cursor:pointer;}
    </style>
    <form action="" method="post">
        <div class="panel panel-default">
            <div class="panel-body table-responsive">
                <table class="table table-hover">
                    <thead class="navbar-inner">
                        <tr>
                            <th width="3%">ID</th>
                            <th width="6%">排序</th>
                            <th width="9%">夺宝商品</th>
                            <th width="26%"></th>
                            <th width="16%">价格/元</th>
                            <th width="10%">当前/总期数</th>
                            <th width="10%">状态</th>
                            <th width="20%">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {loop $list $item}
                        <tr>
                            <td width="6%">{$item['id']}</td>
                            <td width="6%">
                                <input type="text" class="form-control" name="sort[{$item['id']}]" value="{$item['sort']}">
                            </td>
                            <td width="9%" title="{$item['title']}">
                                <img src="{php echo tomedia($item['thumb'])}" style="width:40px;height:40px;padding:1px;border:1px solid #ccc;"  />
                            </td>
                            <td title="{$item['title']}" class='tdedit' width="26%">{$item['title']}</td>
                            <td class='tdedit' width="16%"> {$item['price']}</td>
                            <td >{$item['periods']}/{$item['max_periods']}</td>
                            <td >
                                <label data='{$item['status']}' class='label  label-default {if $item['status']==2}label-info {/if}' onclick="setProperty(this,{$item['id']},'status')" >{if $item['status']==2}上架{else}下架{/if}</label>
                            </td>
                            <td style="position:relative;" width="20%">
                                {ifp 'shop.goods.edit|shop.goods.view'}<a href="{php echo $this->createWebUrl('shop/goods', array('id' => $item['good_id'], 'op' => 'post'))}" class="btn btn-sm btn-default" title="{ifp 'shop.goods.edit'}编辑商品{else}查看商品{/if}">{ifp 'shop.goods.edit'}编辑商品{else}查看商品{/if}</a>{/if}
                                
                               <a href="{php echo $this->createPluginWebUrl('indiana/period', array('id' => $item['id']))}"  title="查看往期" class="btn btn-sm btn-default">查看往期</a>

                               <a href="{php echo $this->createPluginWebUrl('indiana/good_info', array('id' => $item['id'], 'op' => 'edit'))}"  title="编辑夺宝" class="btn btn-sm btn-default">编辑夺宝</a>

                                {ifp 'shop.goods.delete'}<a href="{php echo $this->createPluginWebUrl('indiana/goods', array('id' => $item['id'], 'op' => 'delete'))}" onclick="return confirm('确认删除此商品？');
                                        return false;" class="btn btn-default  btn-sm" title="删除"><i class="fa fa-times"></i></a>{/if}
                            </td>
                        </tr>

                        {/loop}
                        <tr>
                            <td colspan='10'>
                                {ifp 'shop.goods.add'}
                                <a class='btn btn-primary' href="javascript:;" onclick="popwin = $('#modal-module-menus-notice').modal();"><i class='fa fa-plus'></i> 发布商品</a>
                                {/if}
                                {ifp 'shop.goods.edit'}
                                <input name="submit" type="submit" class="btn btn-default" value="提交排序">
                                <input type="hidden" name="token" value="{$_W['token']}" />
                                {/if}

                            </td>
                        </tr>

                        </tr>
                    </tbody>
                </table>
                {$pager}
            </div>
        </div>
    </form>
</div>
</div>
</div>
</div>
<!-- 搜索商品 弹出开始 -->
<div id="modal-module-menus-notice"  class="modal fade" tabindex="-1">
    <div class="modal-dialog" style='width: 920px;'>
        <div class="modal-content">
            <div class="modal-header"><button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button><h3>选择商品</h3></div>
            <div class="modal-body" >
                <div class="row">
                    <div class="input-group">
                        <input type="text" class="form-control" name="keyword" value="" id="search-kwd-notice" placeholder="请输入商品名称/商品ID" />
                        <span class='input-group-btn'><button type="button" class="btn btn-default" onclick="search_members();">搜索</button></span>
                    </div>
                </div>
                <div id="module-menus-notice" style="padding-top:5px;"></div>
            </div>
            <div class="modal-footer"><a href="#" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</a></div>
        </div>
    </div>
</div>

<script language='javascript'>
  function search_members() {
     if( $.trim($('#search-kwd-notice').val())==''){
        $('#search-kwd-notice').attr('placeholder','请输入关键词');
         return;
     }
    $("#module-menus-notice").html("正在搜索....")
    $.get('{php echo $this->createPluginWebUrl('indiana/goods',array('op'=>'getGood'))}', {
      keyword: $.trim($('#search-kwd-notice').val())
    }, function(dat){
      $('#module-menus-notice').html(dat);
    });
  }
  function select_member(good) {
    $(".modal-footer > .btn-default").click();
    location.href = "{php echo $this->createPluginWebUrl('indiana/good_info')}&gid="+good.id;
  }

</script>
<!-- 搜索商品 弹出结束 -->


<script type="text/javascript">
    function setProperty(obj, id, type) {
        $(obj).html($(obj).html() + "...");
        $.post("{php echo $this->createPluginWebUrl('indiana/goods')}"
                , {'op': 'setgoodsproperty', id: id, type: type, data: obj.getAttribute("data")}
        , function (d) {
            $(obj).html($(obj).html().replace("...", ""));
            if (type == 'status') {
                $(obj).html(d.data == '2' ? '上架' : '下架');
            }
            $(obj).attr("data", d.data);
            if (d.result == 1) {
                $(obj).toggleClass("label-info ");
            }
        }
        , "json"
                );
    }

</script>
{template 'web/_footer'}


