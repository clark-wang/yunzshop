{template 'common/header'}
<title>{$title}</title>
<style type="text/css">
    body {margin:0px; background:#efefef; -moz-appearance:none; -webkit-appearance: none;}
    .indiana_topbar {height:auto; width:100%; background:#fff; border-bottom:1px solid #e3e3e3; padding: 5px 0; background: #e9e9e9;}
    .indiana_topbar .inner {height: 22px;color: #555;line-height: 22px;font-size: 12px;}

    .indiana_main {height:30px; width:100%; background:#fff;line-height: 30px;  margin-top:5px; border-bottom:1px solid #e2e2e2; border-top:1px solid #e2e2e2;}
   	.indiana_main .inner  {text-align: center;font-size: 11px;}
	.indiana_main .top  {text-align: center;font-size: 12px;float: left;}
	.indiana_main .info  {font-size: 12px;float: left;}

    .indiana_inner {height:auto; width:100%; background:#fff;line-height: 30px;  border-bottom:1px solid #e2e2e2; border-top:1px solid #e2e2e2;}
	.indiana_inner .top  {text-align: center;font-size: 12px;float: left;}
	.indiana_inner .info  {font-size: 12px;float: left;}

    .order_no {height:40px; width:90%;  padding-top:10px; margin:50px 0px;}

    .order_no {height:100px; width:90%; margin:50px 0px 60px; color:#BFBFBF; font-size:12px; text-align:center;}
    .order_no_menu {height:40px; width:90%; text-align:center;}
    .order_no_nav {height:34px;padding:6px 20px;background:#eee; border:1px solid #d4d4d4; border-radius:5px; text-align:center; line-height:34px; color:#666;font-size: 16px}
</style>

<script language="javascript" src="../addons/sz_yi/static/js/dist/bootstrap.min.js"></script>
<link href="../addons/sz_yi/static/css/bootstrap.min.css" rel="stylesheet">

    <div class="page_topbar">
    	<a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
    	<div class="title">{$title}</div>
	</div>
    <div class="indiana_topbar">
		<div class='inner' style="font-size: 14px;">{$indiana['title']}</div>
		<div class='inner'>期号：{$indiana['period_num']}</div> 
		{if $indiana['status'] == 3}
		<div class='inner'>揭晓时间：{$indiana['endtime']}</div> 
		<div class='inner'>本期幸运号：<span style="color:#f00">{$indiana['code']}</span></div> 
		{/if}
    </div>

    <div class="indiana_main">
    	<div class="inner">
			我已参与<span style="color:#f00">{$indiana['count']}</span>人次，以下是所有夺宝记录
		</div>
    </div>
    <div class="indiana_main">
    	<div class="top" style="width:47%">夺宝时间</div>
    	<div class="top" style="width:25%">参与人次</div>
    	<div class="top" style="width:25%">操作</div>
    </div>


<div id='container'></div>

<script id='tpl_order' type='text/html'>
<div class="indiana_inner">
    <%each list as indiana%>
	    <div style="width:100%;height:30px;border-bottom: 1px solid #e2e2e2;">
	    	<div class="info" style="width:47%"><%indiana.create_time%> <%indiana.microtime%></div>
	    	<div class="top" style="width:25%"><span style="color:#f00"><%indiana.num%></span>人次</div>
	    	<div class="top" style="width:25%">
	    		<span style="color:rgb(11, 14, 246);cursor: pointer;" data-createtime="<%indiana.create_time%>" data-toggle="modal" data-target="#modal-confirmsend<%indiana.id%>">查看号码</span>
	    	</div>
	    </div>

		<div id="modal-confirmsend<%indiana.id%>" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="width:85%;margin:20% auto;">
		   <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header" style="padding: 5px 15px;">
		                <button aria-hidden="true" data-dismiss="modal" class="close" type="button" style="margin-top:8px">×</button>
		                <h4>我的夺宝码</h4>
		            </div>
		            <div class="modal-body">
		                    <div class="form-group" style="margin-bottom: 5px;">
		                      <%indiana.create_time%> <%indiana.microtime%>
		                    </div>
		                    <div class="form-group" style="height: auto;overflow: hidden;margin-bottom: 5px;">
			                    <%each indiana.codes as code%>
			                    	<div style="float: left;margin: 2px ;height:20px"><%code%></div>
			                    <%/each%>
		                    </div>
		            </div>
		        </div>
		   </div>
		</div>
    <%/each%>
</div>
</script>

<script id='tpl_empty' type='text/html'>
    <div class="order_no no-icon"><i class="fa fa-file-text-o"></i><br><span>您还没有相关的夺宝记录哦~</span><br>可以去看看哪些想买的</div>
    <div class="order_no_menu">
        <span class="order_no_nav"  onclick="location.href='{php echo $this->getUrl()}'">随便逛逛</span>
    </div>
</script>







<script language='javascript'>
	var page = 1;
	var periodnum = '{$period_num}';
	require(['tpl', 'core'], function(tpl, core) {
		function getList(status) {
			core.pjson('indiana/info', {page:page, periodnum: periodnum}, function(json) {

			    if (json.result.list.length <= 0) {
			        $("#container").html(tpl('tpl_empty'));
			        return;
			    }
			    $("#container").html(tpl('tpl_order', json.result));
			    	var loaded = false;
			      	var stop=true; 
			      	$(window).scroll(function(){ 
						if(loaded){
						  return;
						}
			            totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 
			            if($(document).height() <= totalheight){ 
			                if(stop==true){ 
			                    stop=false; 
			                    $('#container').append('<div id="order_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
			                    page++;
			                    core.pjson('indiana/info', {page:page, periodnum: periodnum}, function(morejson) {  
			                        stop = true;
			                        $('#order_loading').remove();
			                        $("#container").append(tpl('tpl_order', morejson.result));
			                        if (morejson.result.list.length <morejson.result.pagesize) {
			                            $('#container').append('<div id="order_loading">已经加载全部夺宝记录</div>');
			                            loaded = true;
			                            return;
			                        }
			                    },true); 
			                } 
			            } 
			        });
			}, true);
		}
	    // $('.nav').unbind('click').click(function () {
	    $(document).on('click','.nav',function () {
	        status = $(this).data('status');
			getList(status);
	    });
		getList(status);
	});
</script>
{php $show_footer = true}
{template 'common/footer'}
