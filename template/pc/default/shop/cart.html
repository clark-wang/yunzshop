{template 'common/header'}
<title>购物车</title>
{template 'common/navigation'}
<!--  -->

<div class="w m0a">
	<div class="cart-main cart-main-new">
		<div class="cart-thead">
			<div class="column t-checkbox">
				<div class="cart-checkbox">
					<input class="jdcheckbox all fa-check-circle-o" sel="1" name="toggle-checkboxes" type="checkbox">
				</div>
				全选 </div>
			<div class="column t-goods">
				商品</div>
			<div class="column t-props">
&nbsp;</div>
			<div class="column t-price">
				单价(元)</div>
			<div class="column t-quantity">
				数量</div>
			<div class="column t-sum">
				小计(元)</div>
			<div class="column t-action">
				操作</div>
		</div>
		<div class="cart-item-list">
			<div class="shop">
				<div class="cart-checkbox">
					<input class="jdcheckbox" type="checkbox"> </div>
				<span class="shop-txt">
				<a class="shop-name self-shop-name" href="#">芸众商城</a> </span>
			</div>
			
			<div class="item-list">
				<div class="item-full minus-item">


					{loop $list $good}
					<!-- list begin -->
					<div class=" item-last item-item " 
							data-cartid="{$good['id']}"
							sel='1'
							data-marketprice="{$good['marketprice']}"
							data-goodsid="{$good['goodsid']}"
							>


						<div class="item-form">
							<div class="cell p-checkbox">
								<div class="cart-checkbox">
	 							 <input  type="checkbox"  class="jdcheckbox">					
								</div>
							</div>
							<div class="cell p-goods">
								<div class="goods-item">
									<div class="p-img">
										<a href="#"><img src="{php echo $good['thumb']}"></a>
									</div>
									<div class="item-msg">
										<div class="p-name"><a href="{php echo $this->createMobileUrl('shop/detail',array('id' => $good['goodsid']))}">{php echo $good['title']}</a></div>
									</div>
								</div>
							</div>
							<div class="cell p-props p-props-new">
								<div class="props-txt">颜色：红色</div>
							</div>
							<div class="cell p-price"><strong>{php echo $good['marketprice']}</strong></div>
							<div class="cell p-quantity">
								<div class="quantity-form" data-maxbuy="{$good['maxbuy']}" data-stock="{$good['stock']}">
									<div class="decrement">-</div>
									<input type="text" class="itxt" value="{$good[total]}">
									<div class="increment">+</div>
								</div>
								<!-- <input type="hidden" name="maxbuy" class="maxbuy" value="{$good['maxbuy']}"> -->
							</div>
							<div class="cell p-sum"><strong id="{$good['id']}">{php echo $good[total] * $good['marketprice']}</strong></div>
							<div class="cell p-ops">
								<a  class="cart-remove" href="#">删除</a>
								<a href="#" class="cart-follow">移到我的收藏</a>
							</div>						
						</div>
					</div>
					<!-- list end -->
					{/loop}

				</div>
			</div>

		</div>
		<!-- 结算 -->
		<div class="cart-toolbar">
			<div class="options-box">
				<div class="select-all">
					<div class="cart-checkbox">
						<input type="checkbox"  class="jdcheckbox all fa-check-circle-o" sel="1">
					</div>全选
				</div>
				<div class="operation">
					<a href="#" class="remove-batch fl">删除选中的商品</a>
					<a href="#" class="remove-batch fl">移动到我的收藏</a>
				</div>
				<div class="toolbar-right">
					<div class="comm-right">
						<div class="btn-area"><a href="#" class="submit-btn">去结算</a></div>
						<div class="price-sum">
							<div>
								<span class="txt">品总价（含运费）：</span>
								<span class="price sumPrice"><em id="totalprice"></em></span>
								<br>
								<span class="txt">共<em id="total"></em>件商品</span>
								<span class="price totalRePrice"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		/*function setSelect(obj, sel,isall){
	        if(sel=='1'){
	          	obj.find('i').addClass('fa-circle-o').removeClass('fa-check-circle-o').css('color', '#999');
	        }else{
				obj.find('i').removeClass('fa-circle-o').addClass('fa-check-circle-o').css('color', '#0c9');
	        }
	        sel =sel==1?0:1;
	        if(!isall){
	       		obj.parent().attr('sel',sel);
	        }else{
	            obj.attr('sel',sel);
	        }
	        calcprice();
	    }*/
		$(".all").click(function(){
			//alert("hello");
			var $this = $(this);
            var sel = $this.attr('sel');
            //alert(sel);
            $(".ico").each(function(){
            	setSelect($(this),sel)
            });
            setSelect($(this),sel,true);
		});
		/*$(".ico").click(function(){
            setSelect($(this),$(this).parent().attr('sel'))
        });*/
	    function calcprice(){
	    	var total = 0;
	    	var totalprice = 0;
	    	$(".item-last").each(function(){
	    		var $this = $(this);
	    		var sel = $this.attr('sel') == '1';
	    		//alert(sel);
	    		if(sel){
	    			var num = $this.find(".itxt").val();
	    			if(isNaN(num)){
	    				num = 1;
	    			}
	    			//alert(num);
	    			total+=parseInt(num);
	    			//alert(total);
	    			totalprice+=parseFloat($this.find('.itxt').val()) * parseFloat($this.attr('data-marketprice'));
	    			//alert(totalprice);
	    			//var market = $this.attr('data-marketprice');
	    			//alert(market);
	    		}
	    		//alert(single);
	    		var number=document.getElementById("total");
	    		number.innerHTML=total;
	    		var quantity=document.getElementById("totalprice");
	    		quantity.innerHTML="￥" + totalprice;
	    	});

	    }
		$(".decrement").click(function(){
            var input =$(this).next();
            var num = parseFloat( input.val() );
            num--;
            if(num <= 0){
                num=1;
            }
            input.val(num);
			//alert(input.val());
			//alert(num);
			var single = $(this).parent().parent().parent().parent().attr('data-marketprice');
			var cartid = $(this).parent().parent().parent().parent().attr('data-cartid');
			single = input.val() * single;
			var singlemon=document.getElementById(cartid);
	    	singlemon.innerHTML="￥" + single;
			calcprice();
		});
		$(".increment").click(function(){
			var maxbuy = $(this).parent().attr('data-maxbuy');
			var stock = $(this).parent().attr('data-stock');
			//alert(stock);
			var input =$(this).prev();
            var num = parseFloat( input.val() );
            num++;
            if(num >= maxbuy && maxbuy > 0){
                num = maxbuy;
                alert("您最多购买 " + maxbuy + "件");
            } else if(stock!='-1' && stock!='' && num>stock){
            	num=stock;
            	alert("您最多购买 " + stock + "件");
            }
            input.val(num);
            var single = $(this).parent().parent().parent().parent().attr('data-marketprice');
			var cartid = $(this).parent().parent().parent().parent().attr('data-cartid');
			single = input.val() * single;
			var singlemon=document.getElementById(cartid);
	    	singlemon.innerHTML="￥" + single;
            calcprice();
		});

		calcprice();
	})
</script>
<!-- foot -->
<div class="cover-page-foot fl wfs">
<p class="subnav">
<a target="_blank" href="http://about.ecmoban.com/company.php#contact">联系我们</a>
<a target="_blank" href="http://about.ecmoban.com/company.php">公司简介</a>
<a target="_blank" href="http://about.ecmoban.com/payment.php">支付方式</a>
<a target="_blank" href="http://about.ecmoban.com/legal.php">法律条款</a>
<a target="_blank" href="http://www.ecmoban.com/daili.php">合作代理</a>
<a target="_blank" href="http://about.ecmoban.com/friendlink.php">友情链接</a>
<a target="_blank" href="http://about.ecmoban.com/hr.php">诚聘英才</a>
<a class="last" target="_blank" href="http://www.ecmoban.com/topic/feature_list/index.html">服务支持</a>
</p>
<p class="copyright">© 2005-2016 ecshop模板堂(ecmoban.com) 版权所有，并保留所有权利。常年法律顾问:<a class="copyright" target="_blank" href="http://about.ecmoban.com/article-1557.html">上海华宏律师事务所</a></p>
<p class="address">上海市普陀区中山北路3553号伸大厦3层</p>
<div style="background-color:#E1E1E1; text-align:center; height:20px;padding-top:5px;">
<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010702001054" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="http://www.ecmoban.com/content/themes/ecmoban2014/images/beian_ghs.png" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">沪公网安备 31010702001054号</p></a>
<div>
</div>
<!--  -->

</body>

</html>
