{template 'common/header'}

<title>爱心基金</title>

<style type="text/css">

body {margin:0px; background:#eee; font-family:'微软雅黑'; -moz-appearance:none;}

a {text-decoration:none;}
.log_top {height:44px; width:100%;  background:#f8f8f8;  border-bottom:1px solid #e3e3e3;}
.log_top .title {height:44px; width:auto;margin-left:10px; float:left; font-size:16px; line-height:44px; color:#666;}
.log_top .num { float:right;color:#666;height:44px;line-height:44px;padding-right:5px;}
.log_menu,.log_menuq {height:44px; background:#fff;width:100%;}
.log_menu .nav,.log_menuq .nav {height:44px; width: calc(100% / 3.08);width: -webkit-calc(100% / 3.08);width: -moz-calc(100% / 3.08);display: inline-block; border-bottom:1px solid #f1f1f1;background:#fff; border-left:1px solid #f1f1f1; float:left; line-height:44px; font-size:14px; color:#666; text-align:center;}
.log_menu .navon,.log_menuq .navon {height:42px; color:#ff771b; border-bottom:2px solid #ff771b;}
#hrl{border-bottom:2px solid #FAAC77;width:100%;margin:8px 0px;}
.log_title {height:40px; padding:5px; line-height:50px; font-size:16px; color:#666;}
.log_list,.log_lista,.log_listb {height:40px; background:#fff;margin-top:5px;}
.log_list .left,.log_lista .left ,.log_listb .left {height:40px; width:100%;color:#999; font-size:14px;}
.log_list .left .inner,.log_lista .left .inner,.log_listb .left .inner { width:100%;overflow:hidden;}
.log_list .left span,.log_lista .left span,.log_listb .left span {color:#666; font-size:13px; line-height:40px;}
.log_list .right,.log_lista .right,.log_listb .right {height:40px; width:20%; float:right; font-size:14px; text-align:right; line-height:18px; }
.log_list .right span,.log_lista .right span ,.log_listb .right span {color:#f90;}
.log_no {height:100px; width:100%; margin:50px 0px 60px; color:#ccc; font-size:12px; text-align:center;}
#log_loading { padding:10px;color:#666;text-align: center;}
.sed-nav{ background: #fff;height:40px;margin-bottom: 6px;padding: 0 5px;}
.sed-nav .nav2{ float: left;height: 30px;padding: 5px;box-sizing: border-box;}
.sed-nav .nav2 a{ display: block;width: 100%;background: #eee;border-radius: 3px;color: #5e5e5e;text-align: center;line-height: 30px}
.sed-nav .nav2:hover a,.sed-nav .nav2.hover a{background: #ff771b;color: #fff}
.w33{ width: 33.3333%;}.w50{ width: 50%;}

.income{ background: #f7f7f7;min-height: 40px;width: 100%;padding:4px 0 4px 10px;overflow: hidden;box-sizing: border-box;width: 100%}
.income1{ background: #f7f7f7;width: 100%;padding:4px 0 4px 10px;overflow: hidden;box-sizing: border-box;width: 100%}
.income p{ color: #5e5e5e;float: left;line-height: 26px;margin: 0;padding: 0 4% 0 0;font-size: 14px;width: 50%;box-sizing: border-box;display: block;}
.income1 p{ color: #5e5e5e;float: left;line-height: 26px;margin: 0;padding: 0 4% 0 0;font-size: 14px;width: 50%;box-sizing: border-box;display: block;}
.pfloat{ float: left;width: 33.3333%}
.gxjj{background: #f7f7f7;color: #5e5e5e;line-height: 40px;font-size: 14px;float: left;margin-top: 4px}
.text-input{ background: #fff;border:1px #e1e1e1 solid;width: 14%;height: 24px;display: inline-block;margin: 0 4px}
.gxjj a{ background:#02bb00;color: #fff;;width: 60px;height: 28px;text-align: center;line-height: 28px;display: inline-block;margin: 0 4px}
.name-use{width: 25%;overflow: hidden;text-overflow: ellipsis;float: left;white-space: nowrap;color: #000;line-height: 40px;padding-left: 8px;margin: 0}
.inner em{ float: left;font-style: normal;line-height: 40px;padding-left: 4px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width: 40%;}
.right-s{ float: right;padding-right: 4px;width: 30%;line-height: 40px;text-align: right;}
</style>
<div class="log_top">
       <div class="title" onclick='history.back()'><i class='fa fa-chevron-left'></i> 基金明细</div>
</div>
<div class="log_menu">
        <div class="nav navon" data-status='1'>爱心总览</div>
        <div class="nav"  data-status='2'>平台基金</div>
        <div class="nav"  data-status='7'>会员基金</div>
</div>
<div id='containers'></div>
<div class="sed-nav">
    <div class="nav2 w33 hover"  data-status="1"><a href="#">所有基金</a></div>
    <div class="nav2 w33"  data-status="3"><a href="#">我的贡献</a></div>
    <div class="nav2 w33"  data-status="9"><a href="#">基金事业</a></div>
</div>
<script id='tpl_main' type='text/html'>
<div class="income"><p>累计基金:<span id='total'>{$total}</span>元</p>
<p>我的贡献:<span id='metotal'>{$mytotal}</span>元</p>
<p id='aassss1'>已用基金:<span id='uselove'>{$usetotal}</span>元</p>
</div>
<div style="clear:both"></div>
<div id='aassss' class="income1">
</div>
</script>
<script language="javascript">
    require(['tpl', 'core'], function(tpl, core) {    
        core.pjson('love/log',{},function(json){
		   $('#containers').html(  tpl('tpl_main',json.result) );
        },true);    
    })

</script> 

<div id='container'></div>

<script id='tpl_log' type='text/html'>
<%if status==9 %>
  <%each list as log%>
     <div class="log_lista" data-goodsid='<%log.id%>'>
      <div class="left">
     <div class="inner">
         <em><%log.title%></em>
        <span class="right-s"><%log.createtime%></span></div>
    </div>
     </div>    
  <%/each%>
<%else%>
  <%each list as log%>
    <div class="log_list" data-goodsid='<%log.goodsid%>' >
       <div class="left">
            <div class="inner">
              <p class="name-use"><%log.nickname%></p>
              <em>
              <%log.title%>
              </em>
              <span class="right-s"><%if log.type==1%>平台<%/if%>捐献:
              <%if log.paymonth==1%>
              <%log.money*100%>积分
              <%else%>
              <%log.money%>元
              <%/if%>
              </span>
            </div>
       </div>
    </div>
  <%/each%>
<%/if%>
</script>

<script language="javascript">

var page = 1;

var current_status = '';
var loaded = false;

var stop = true;

require(['tpl', 'core'], function (tpl, core) {

  function bindScroller(){

    //加载更多
    $(window).scroll(function () {

        if (loaded) {

            return;

        }

        totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());

        if ($(document).height() <= totalheight) {

    

            if (stop == true) {

                stop = false;
                $('#container').append('<div id="log_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');

                page++;

                core.pjson('love/log', {status:current_status,page: page}, function (morejson) {

                    

                    $('#log_loading').remove();

                    $("#container").append(tpl('tpl_log', morejson.result));

                    if (morejson.result.list.length < morejson.result.pagesize) {

                        $("#container").append('<div id="log_loading">已经加载完全部订单</div>');

                        loaded = true;

                        $(window).scroll = null;

                        return;

                    }
                    stop = true;

                }, true);

            }

        }

    });

  }

    function getLog(status) {
      $('.log_menu .nav').removeClass('navon');

		if(status==9)$('#containers').css("display","none");

		else $('#containers').css("display","block");

		if(status=='')status=1;

        $('.log_menu .nav[data-status=\'' + status + '\']').addClass('navon');

    core.pjson('love/log', {status:status, page: page}, function (json) {
       var data = json.result;
		   if(status==7)
		   {
  		    var html='<p>我的佣金:<span id="commission_total">'+data.member.commission_ok+'</span>元</p>';
  		        html+='<p>我的积分:<span id="commission_total">'+data.member.credit1+'</span></p>';
  		        html+='<p>我的宝币:<span id="commission_total">'+data.member.credit2+'</span>元</p>';

  			  var btnon='<span class="go"><input type="button" onclick="gos()" id="subt" style="border:none;background:#ff771b;line-height:28px;font-size:14px;color:#fff"  value="贡献"/></span>';

  			  var btnoff='<input type="button"  style="border:none;background:none;line-height:20px;font-size:14px" id="subt" disabled="disabled"  value="(您的没有财富可贡献)"/>';

		      if(data.member.commission_ok>0 || data.member.credit1>0 || data.member.credit2>0){
                  html+='<div class="gxjj" >捐献类别:';
                  html+='<span class="gender" data-val="1" style="margin:0 4px"><i class="fa fa-check-circle-o" style="color:#0C9;"></i> 积分(1:100)</span>&nbsp;&nbsp;';
                  html+='<span class="gender" data-val="2" style="margin:0 4px"><i class="fa fa-circle-o"></i>宝币<input type="hidden" id="gender" value="1"></span>';
                  html+='<span class="gender" data-val="3" style="margin:0 4px"><i class="fa fa-circle-o"></i>佣金<input type="hidden" id="gender" value="1"></span>';
                  html+='</div>';
			      html+='<div class="gxjj">我要贡献:<span id="s"><input type="txt" size="8" name="pay" id="pay" value="" class="text-input"/></span>元&nbsp;'+btnon+'</div>';
          }else{
            html+='<div class="gxjj">我要贡献:<span id="s"><input type="txt" size="8" name="pay" id="pay" value="" class="text-input"/></span>元&nbsp;'+btnoff+'</div>';
          }

    		  $('#aassss').html(html);
    	 }else{
               var html = '';
               //var html="已用基金:<span id='uselove'>{$uselove}</span>元";
               $('#aassss').html(html);
		   }
       $('.gender').click(function() {
             var $this = $(this);
              var val = $this.data('val');
              $('.gender').find('i').css('color', '#999').removeClass('fa-check-circle-o').addClass('fa-circle-o');
              $(this).find('i').removeClass('fa-circle-o').addClass('fa-check-circle-o').css('color', '#0c9');
              $('#gender').val(val);
            });

            $('.go').delegate('input','click',function(){
        var pay=$("#pay").val();
        var gender=$('#gender').val();
        var reg = /^\d+$/;
        if(pay==''){
         core.tip.show("请输入贡献宝币！");
         $("#pay").focus();
        }
        else if(pay.match(reg))
        {
          if(pay=='0'){
            core.tip.show("请输入大于0的数值！");$("#pay").focus();
          }
          else{
            core.pjson('love/log',{'op':'submit','pay':pay+'#'+gender},function(json){
              if(json.status == 1){
                location.href = json.result.url;
              }else{
                core.tip.show(json.result.message);
              }
            },true);
          } 
       }
       else
        {
         core.tip.show("只能输入数字！");
         $("#pay").focus();
        }
        return;

        });

        if (json.result.list.length<=0) {
	         var tpl_empty='<div class="log_no"><i class="fa fa-file-text-o" style="font-size:100px;"></i><br><br><span style="line-height:18px; font-size:16px;">暂无信息~</span></div>';
            $('#container').html(tpl_empty);
            return;
        }
           

            $('#container').html(tpl('tpl_log', json.result));

             $('.log_list').unbind('click').click(function(){

                var goodsid = $(this).data('goodsid');
                if(goodsid > 0){
                  var url = core.getUrl('shop/detail',{'id':goodsid});
                  location.href = url;
                }

                return;

             });

             $('.log_lista').unbind('click').click(function(){

                var goodsid = $(this).data('goodsid');
                alert(goodsid);
                if(goodsid > 0){
                  var url = core.getUrl('plugin/article',{'aid':goodsid});
                  location.href = url;
                }

                return;

             });

            bindScroller();

        }, true);

    }

    function getLogq(status) {

        $('.sed-nav .nav2').removeClass('hover');

		if(status=='')status=1;

        $('.sed-nav .nav2[data-status=\'' + status + '\']').addClass('hover');
        core.pjson('love/log', {status:status, page: page}, function (json) {

            if (json.result.list.length<=0) {

			var tpl_empty='<div class="log_no"><i class="fa fa-file-text-o" style="font-size:100px;"></i><br><br><span style="line-height:18px; font-size:16px;">暂无信息~</span></div>';

                $('#container').html(tpl_empty);

                return;

            }

            $('#container').html(tpl('tpl_log', json.result));

             $('.log_list').unbind('click').click(function(){

                var goodsid = $(this).data('goodsid');
                if(goodsid > 0){
                  var url = core.getUrl('shop/detail',{'id':goodsid});
                  location.href = url;
                }
                return;

             });

             $('.log_lista').unbind('click').click(function(){

                var goodsid = $(this).data('goodsid');
                if(goodsid > 0){
                  var url = core.getUrl('plugin/article',{'aid':goodsid});
                  location.href = url;
                }

                return;

             });

            bindScroller();

        }, true);

    }

     

    $('.log_menu .nav').unbind('click').click(function () {

        page = 1;current_status = $(this).data('status');

		

		if(current_status=='1')

		$('.sed-nav').html('<div class="nav2 w33 hover"  data-status="1"><a href="#">所有基金</a></div><div class="nav2 w33"  data-status="3"><a href="#">我的贡献</a></div><div class="nav2 w33"  data-status="9"><a href="#">基金事业</a></div>');

        if(current_status=='2')

		$('.sed-nav').html('<div class="nav2 w50 hover"  data-status="2"><a href="#">所有基金</a></div><div class="nav2 w50"  data-status="5"><a href="#">我的贡献</a></div>');

        if(current_status=='7')

		$('.sed-nav').html('<div class="nav2 w50 hover" data-status="7"><a href="#">所有基金</a></div><div class="nav2 w50"  data-status="8"><a href="#">我的贡献</a></div>');

		getLog(current_status);

    });

    $('.sed-nav').delegate('div','click',function(){

	    page = 1;
      current_status = $(this).data('status');

	

        getLogq(current_status);

    });

    getLog('');



 })

</script>

{php $show_footer=true;$footer_current ='commission'}

{template 'common/footer'}

