<link rel="stylesheet" type="text/css" href="../addons/sz_yi/plugin/card/template/mobile/default/images/style.css">
<style type="text/css">
	#card_chooser_layer {height: 100%; width: 100%; background: rgba(0,0,0,0.6); position: fixed; top: 0px; left: 0px; z-index: 9;display:none }
	#card_chooser {height:auto; width:100%;padding-bottom:45px; background:#eee; position:fixed; bottom:0px; left:0px; z-index:10;display:none}


	.card_list { width:100%;overflow:auto; overflow-x:hidden;}
	.card_get { margin:10px 30px;border:1px solid #ff6600; color:#ff6600; background:#fff; border-radius: 3px; text-align: center;padding:5px 0;font-size:13px;}
	.card_no {height:100px;  margin:50px 0px 60px; color:#bbb; font-size:12px; text-align:center;}
	.card_no_menu {height:40px; width:100%;}
	.card_no_nav {height:38px; width:43%; background:#eee; margin:0px 3%; float:left; border:1px solid #d4d4d4; border-radius:5px; text-align:center; line-height:38px; color:#666;}
	.card_footer { position: absolute;; bottom:0px; height:45px;width:100%;}
	.card_footer .card_btn { float:left;height:45px;line-height:45px; font-size:14px; text-align: center; color:#fff;}
	.card_footer .card_cancel { background:#ccc; width:40%; }
	.card_footer .card_confirm { background:#f60; width:60%; }


</style>
<div id='card_container'></div>
<script id='tpl_cards' type='text/html'>
	<div id="card_chooser_layer"></div>
	<div id="card_chooser">
		<div class="card_list">
			<%each cards as card%>
			<div class="card_item"
				 data-cardid="<%card.id%>"
				 data-balance="<%card.balance%>"
			>
				<div class='bg cside side side-left'></div>
				
			<div class="cinfo" >
				<div class="inner" >
					<div class="name"><%card.balance%></div>
					<div class="time">
						<%if card.timestr==''%>
						永久有效
						<%else%>
						<%if card.past%>已过期<%else%>
						有效期 <%card.timestr%>
						<%/if%>
						<%/if%></div>
				</div>
			</div>
			<div class="cright">
				<div class="bg png png-deduct"></div>
				<div class="bg sideleft side side-deduct"></div>
				<div class="rinfo" >
					<div class='rinner deduct'>
						<div class="price"><%if card.balance%>￥<%/if%><span><%card.balance%></span></div>
						<div class="type"><%card.backstr%></div>
					</div>
				</div>
				<div class="bg sideright side side-deduct"></div>

			</div>
		</div>
		<%/each%>

	</div>

	<div class="card_footer">
		<div class="card_btn card_cancel">不使用{$card_set['gift_title']}</div>
		<div class="card_btn card_confirm">确定使用</div>
	</div>
	</div>
</script>
<script language="javascript">
	var CardChooser = {};
	require(['core','tpl'],function(core,tpl){
		CardChooser.close = function(){
			$('#card_chooser_layer').hide();
			$('#card_chooser').hide();
		}
		CardChooser.open = function(result){
			var html = tpl('tpl_cards',result);
			$('#card_container').html(html);
			var h = $(document.body).height() * 0.7;
			$('#card_chooser').css('max-height',h).fadeIn(300);
			$('.card_list').css('max-height',h);
			$('#card_chooser_layer').fadeIn(300).unbind('click').click(function(){
				CardChooser.close();
			});

			var cardid = $("input[data-name='cardid']").val();
			if( cardid== '' ) {
				cardid='0';
			}

			$('#card_chooser .card_item').removeClass('card_selected');
			$('#card_chooser .card_item[data-cardid=' +cardid +']' ).addClass('card_selected');


			$('#card_chooser .card_item').unbind('click').click(function(){
				$('#card_chooser .card_item').removeClass('card_selected');
				$(this).addClass('card_selected');
				$("input[data-name='cardid']").val($(this).data('cardid'));
				$('.cardselect').data({
					'cardid':$(this).data('cardid'),
					'balance':$(this).data('balance')
				}).html("我选择了{$card_set['gift_title']}");

			});
			$('#card_chooser .card_cancel').unbind('click').click(function(){
				$("input[data-name='cardid']").val('');
				$('.cardselect').html("我要使用{$card_set['gift_title']}");
				$('#card_chooser .card_item').removeClass('card_selected');
				CardChooser.close();
				if(CardChooser.cancelCallback){
					CardChooser.cancelCallback();
				}
			});
			$('#card_chooser .card_confirm').unbind('click').click(function(){
				if($("input[data-name='cardid']").val()=='' || $("input[data-name='cardid']").val()=='0'){
					core.tip.show("请选择{$card_set['gift_title']}!");
					return;
				}

				$('#card_chooser .card_item').removeClass('card_selected');

				CardChooser.close();
				if(CardChooser.confirmCallback){
					CardChooser.confirmCallback();
				}







			});


		}
	});


</script>
